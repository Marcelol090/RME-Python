============================= test session starts =============================
platform win32 -- Python 3.12.4, pytest-9.0.2, pluggy-1.6.0
PyQt6 6.10.2 -- Qt runtime 6.10.2 -- Qt compiled 6.10.0
rootdir: C:\Users\Marcelo Henrique\Desktop\projec_rme
configfile: pyproject.toml
plugins: anyio-4.12.0, cov-7.0.0, qt-4.5.0
collected 533 items

tests\core\assets\test_creatures_loader.py .........                     [  1%]
tests\logic_layer\cross_version\test_auto_correction.py ...........      [  3%]
tests\logic_layer\cross_version\test_clipboard.py ........               [  5%]
tests\logic_layer\cross_version\test_sprite_hash.py ..........           [  7%]
tests\logic_layer\operations\test_export_statistics.py ............      [  9%]
tests\logic_layer\operations\test_import_creatures.py ........           [ 10%]
tests\logic_layer\operations\test_remove_monsters.py ...                 [ 11%]
tests\logic_layer\operations\test_selection_operations.py ...            [ 12%]
tests\logic_layer\settings\test_grid_settings.py ...................     [ 15%]
tests\logic_layer\settings\test_light_settings.py ...................... [ 19%]
.                                                                        [ 19%]
tests\logic_layer\settings\test_shortcuts.py ......................      [ 24%]
tests\logic_layer\test_brush_settings.py .......                         [ 25%]
tests\logic_layer\test_brushes.py ..........                             [ 27%]
tests\logic_layer\test_doodad_erase_like.py ...                          [ 27%]
tests\logic_layer\test_door_brush.py .......                             [ 29%]
tests\logic_layer\test_replace_items.py .......                          [ 30%]
tests\preview_tests\test_legacy_dat_reader.py .                          [ 30%]
tests\preview_tests\test_sprite_index.py .                               [ 30%]
tests\preview_tests\test_world_to_screen.py .                            [ 30%]
tests\ui\test_debug_crash.py .                                           [ 31%]
tests\ui\test_gui_example.py .                                           [ 31%]
tests\ui\test_properties_panel.py .......                                [ 32%]
tests\ui\test_smoke.py .                                                 [ 32%]
tests\ui\test_ui_placeholder.py .                                        [ 33%]
tests\unit\core\assets\test_appearances_dat.py ...                       [ 33%]
tests\unit\core\assets\test_asset_loader.py ..                           [ 33%]
tests\unit\core\assets\test_asset_profile.py ...                         [ 34%]
tests\unit\core\assets\test_legacy_dat_spr.py .                          [ 34%]
tests\unit\core\assets\test_sprite_appearances_png.py .                  [ 34%]
tests\unit\core\io\test_lua_creature_import.py ...                       [ 35%]
tests\unit\core\io\test_otbm_clientid.py ..                              [ 35%]
tests\unit\core\protocols\test_live_login_payload.py ...                 [ 36%]
tests\unit\core\protocols\test_tile_serializer.py ...                    [ 36%]
tests\unit\logic_layer\history\test_tile_actions.py ...                  [ 37%]
tests\unit\logic_layer\operations\test_map_import.py F                   [ 37%]
tests\unit\logic_layer\templates\test_map_templates.py ................. [ 40%]
..                                                                       [ 41%]
tests\unit\logic_layer\test_action_queue.py ...                          [ 41%]
tests\unit\logic_layer\test_brush_footprint.py ......................... [ 46%]
..................................                                       [ 52%]
tests\unit\logic_layer\test_carpet_brush.py ..                           [ 53%]
tests\unit\logic_layer\test_clipboard.py .............                   [ 55%]
tests\unit\logic_layer\test_drawing_options.py .............             [ 58%]
tests\unit\logic_layer\test_house_brush.py .........                     [ 59%]
tests\unit\logic_layer\test_house_exit_brush.py ......                   [ 60%]
tests\unit\logic_layer\test_item_type_detector.py ...................... [ 65%]
                                                                         [ 65%]
tests\unit\logic_layer\test_map_format_conversion.py ...                 [ 65%]
tests\unit\logic_layer\test_materials_brush_parsing.py ....              [ 66%]
tests\unit\logic_layer\test_performance.py ............................. [ 71%]
......                                                                   [ 72%]
tests\unit\logic_layer\test_png_exporter.py .                            [ 73%]
tests\unit\logic_layer\test_recent_brushes.py ..                         [ 73%]
tests\unit\logic_layer\test_selection_depth_integration.py ..            [ 73%]
tests\unit\logic_layer\test_selection_modes.py .............             [ 76%]
tests\unit\logic_layer\test_spawn_monster_brush.py .......               [ 77%]
tests\unit\logic_layer\test_table_brush.py ..                            [ 78%]
tests\unit\test_autoborder_ground_advanced.py ...                        [ 78%]
tests\unit\test_autoborder_wall_like.py ..                               [ 78%]
tests\unit\test_gamemap.py .                                             [ 79%]
tests\unit\test_map_detection.py ...                                     [ 79%]
tests\unit\test_mirroring.py ......                                      [ 80%]
tests\unit\test_otmm_loader.py ......                                    [ 81%]
tests\unit\test_otmm_saver.py .                                          [ 82%]
tests\unit\tools\test_minimap.py ...                                     [ 82%]
tests\unit\vis_layer\test_map_drawer_overlays.py .....                   [ 83%]
tests\unit\vis_layer\test_map_drawer_tooltips.py .                       [ 83%]
tests\unit\vis_layer\test_opengl_renderer.py .........                   [ 85%]
tests\unit\vis_layer\test_qpainter_fallback.py .                         [ 85%]
tests\unit\vis_layer\ui\test_dialogs.py .....................            [ 89%]
tests\unit\vis_layer\ui\test_overlays.py .............                   [ 92%]
tests\unit\vis_layer\ui\test_theme.py ..............                     [ 94%]
tests\unit\vis_layer\ui\test_widgets.py ...................              [ 98%]
tests\vis_layer\ui\overlays\test_drag_shadow.py .........                [100%]

================================== FAILURES ===================================
_________________________ test_import_map_with_offset _________________________

tmp_path = WindowsPath('C:/Users/Marcelo Henrique/AppData/Local/Temp/pytest-of-Marcelo Henrique/pytest-10/test_import_map_with_offset0')

    def test_import_map_with_offset(tmp_path: Path) -> None:
        target_map = GameMap(header=MapHeader(otbm_version=2, width=10, height=10))
        target_map.set_tile(Tile(x=1, y=1, z=7, ground=Item(id=100)))

        source_map = GameMap(header=MapHeader(otbm_version=2, width=5, height=5, housefile="houses.xml"))
        source_map.set_tile(Tile(x=0, y=0, z=7, ground=Item(id=200), items=[Item(id=201)], house_id=1))
        source_map.houses[1] = House(id=1, name="ImportHouse", entry=Position(1, 1, 7), townid=1)

        source_path = tmp_path / "source_map.otbm"
        save_game_map_bundle_atomic(str(source_path), source_map, id_mapper=None)

        report = import_map_with_offset(
            target_map=target_map,
            source_path=source_path,
            offset=(2, 3, 0),
            import_tiles=True,
            import_houses=True,
            import_spawns=False,
            import_zones=False,
            merge_mode=0,
        )

        imported_tile = target_map.get_tile(2, 3, 7)
        assert imported_tile is not None
        assert imported_tile.ground is not None
>       assert imported_tile.ground.id == 200
E       assert 7555 == 200
E        +  where 7555 = Item(id=7555, client_id=200, raw_unknown_id=None, subtype=None, count=None, text=None, description=None, action_id=None, unique_id=None, destination=None, items=(), attribute_map=(), depot_id=None, house_door_id=None).id
E        +    where Item(id=7555, client_id=200, raw_unknown_id=None, subtype=None, count=None, text=None, description=None, action_id=None, unique_id=None, destination=None, items=(), attribute_map=(), depot_id=None, house_door_id=None) = Tile(x=2, y=3, z=7, ground=Item(id=7555, client_id=200, raw_unknown_id=None, subtype=None, count=None, text=None, desc..., house_id=1, map_flags=0, modified=True, zones=frozenset(), monsters=[], npc=None, spawn_monster=None, spawn_npc=None).ground

tests\unit\logic_layer\operations\test_map_import.py:38: AssertionError
------------------------------ Captured log call ------------------------------
WARNING  py_rme_canary.core.io.otbm.loader:loader.py:252 Dynamic ID conversions: server_id_in_client_map=0, client_id_in_server_map=2
============================== warnings summary ===============================
py_rme_canary/tests/ui/test_smoke.py::test_smoke_workflow
  C:\Python312\Lib\site-packages\pytestqt\qtbot.py:304: DeprecationWarning: waitForWindowShown is deprecated, as the underlying Qt method was obsoleted in Qt 5.0 and removed in Qt 6.0. Its name is imprecise and the pytest-qt wrapper does not raise qtbot.TimeoutError if the window wasn't shown. Please use the qtbot.waitExposed context manager instead.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests\unit\logic_layer\operations\test_map_import.py::test_import_map_with_offset
================== 1 failed, 532 passed, 1 warning in 20.65s ==================
